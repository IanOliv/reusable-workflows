name: GitHub Manager Workflows
run-name:  Deploy to  ${{ github.actor }} @ ${{ github.repository }} / ${{ github.run_number }} 

on: [push]

jobs:
  generate-token:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        

      - name: Generate GitHub App Token
        id: generate_token
        uses: ./.github/actions/generate-token  # Use the action defined in the repository
        with:
          app-id: ${{ secrets.APP_ID }}
          private-key: ${{ secrets.PRIVATE_KEY }}

      - name: Generate composite 
        id: generate_token_composite
        uses: ./.github/actions/generate-token-composite  # Use the action defined in the repository

      - name: Use GitHub App Token
        env:
          GITHUB_TOKEN: ${{ steps.generate_token.outputs.token }}
        run: |
          # ls -la
          # ls -la .github
          # ls -la .github/actions
          # ls -la .github/actions/generate-token
          # cat .github/actions/generate-token/action.yml
          echo  "________"
          
          # echo  "${{ secrets.APP_ID }}"
          # echo  "${{ secrets.PRIVATE_KEY }}"
          # echo  "$GITHUB_TOKEN"
          # echo  "________" 
          gh auth login --with-token < $GITHUB_TOKEN
          gh auth status || exit 1

          echo $GITHUB_TOKEN
          # Add your operations here
          echo "Token generated and ready to use"
